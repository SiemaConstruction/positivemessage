<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    orderBy,
    onSnapshot,
    serverTimestamp,
    deleteDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  function startApp() {
    const firebaseConfig = {
      apiKey: "AIzaSyBM0a5KmykgUliAERC-RhGdkjm6M3gGlO4",
      authDomain: "siema-positive-message-board.firebaseapp.com",
      projectId: "siema-positive-message-board",
      storageBucket: "siema-positive-message-board.firebasestorage.app",
      messagingSenderId: "933509777926",
      appId: "1:933509777926:web:b5cc19ac45b31256169187",
      measurementId: "G-GLGN2J7R91"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById('messageForm');
    const input = document.getElementById('messageInput');
    const container = document.getElementById('messagesContainer');

    const stickyColors = [
      "#fff59d", "#ffccbc", "#b2dfdb", "#c5e1a5", "#f8bbd0", "#d1c4e9", "#e1bee7"
    ];

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const text = input.value.trim();
      if (text !== "") {
        await addDoc(collection(db, "messages"), {
          content: text,
          timestamp: serverTimestamp()
        });
        input.value = '';
      }
    });

    const q = query(collection(db, "messages"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      container.innerHTML = '';
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement('div');
        div.className = 'message';
        div.style.backgroundColor = stickyColors[Math.floor(Math.random() * stickyColors.length)];
        div.textContent = data.content;

        // Create delete button
        const delBtn = document.createElement('button');
        delBtn.textContent = " ðŸ—‘ï¸";
        delBtn.style.marginLeft = "10px";
        delBtn.style.background = "transparent";
        delBtn.style.border = "none";
        delBtn.style.cursor = "pointer";
        delBtn.style.color = "#2e7d32";
        delBtn.onclick = async () => {
          if (confirm("Delete this message?")) {
            await deleteDoc(doc(db, "messages", docSnap.id));
          }
        };

        // Append delete button to message
        div.appendChild(delBtn);
        container.appendChild(div);
      });
    });
  }

  startApp();
</script>
